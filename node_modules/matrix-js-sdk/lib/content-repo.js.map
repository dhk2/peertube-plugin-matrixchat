{"version":3,"file":"content-repo.js","names":["utils","_interopRequireWildcard","require","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","getHttpUriForMxc","baseUrl","mxc","width","height","resizeMethod","allowDirectLinks","indexOf","serverAndMediaId","slice","prefix","params","Math","round","toString","keys","length","fragmentOffset","fragment","urlParams","encodeParams"],"sources":["../src/content-repo.ts"],"sourcesContent":["/*\nCopyright 2015 - 2021 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport * as utils from \"./utils\";\n\n/**\n * Get the HTTP URL for an MXC URI.\n * @param baseUrl - The base homeserver url which has a content repo.\n * @param mxc - The mxc:// URI.\n * @param width - The desired width of the thumbnail.\n * @param height - The desired height of the thumbnail.\n * @param resizeMethod - The thumbnail resize method to use, either\n * \"crop\" or \"scale\".\n * @param allowDirectLinks - If true, return any non-mxc URLs\n * directly. Fetching such URLs will leak information about the user to\n * anyone they share a room with. If false, will return the emptry string\n * for such URLs.\n * @returns The complete URL to the content.\n */\nexport function getHttpUriForMxc(\n    baseUrl: string,\n    mxc?: string,\n    width?: number,\n    height?: number,\n    resizeMethod?: string,\n    allowDirectLinks = false,\n): string {\n    if (typeof mxc !== \"string\" || !mxc) {\n        return \"\";\n    }\n    if (mxc.indexOf(\"mxc://\") !== 0) {\n        if (allowDirectLinks) {\n            return mxc;\n        } else {\n            return \"\";\n        }\n    }\n    let serverAndMediaId = mxc.slice(6); // strips mxc://\n    let prefix = \"/_matrix/media/r0/download/\";\n    const params: Record<string, string> = {};\n\n    if (width) {\n        params[\"width\"] = Math.round(width).toString();\n    }\n    if (height) {\n        params[\"height\"] = Math.round(height).toString();\n    }\n    if (resizeMethod) {\n        params[\"method\"] = resizeMethod;\n    }\n    if (Object.keys(params).length > 0) {\n        // these are thumbnailing params so they probably want the\n        // thumbnailing API...\n        prefix = \"/_matrix/media/r0/thumbnail/\";\n    }\n\n    const fragmentOffset = serverAndMediaId.indexOf(\"#\");\n    let fragment = \"\";\n    if (fragmentOffset >= 0) {\n        fragment = serverAndMediaId.slice(fragmentOffset);\n        serverAndMediaId = serverAndMediaId.slice(0, fragmentOffset);\n    }\n\n    const urlParams = Object.keys(params).length === 0 ? \"\" : \"?\" + utils.encodeParams(params);\n    return baseUrl + prefix + serverAndMediaId + urlParams + fragment;\n}\n"],"mappings":";;;;;;AAgBA,IAAAA,KAAA,GAAAC,uBAAA,CAAAC,OAAA;AAAiC,SAAAC,yBAAAC,WAAA,eAAAC,OAAA,kCAAAC,iBAAA,OAAAD,OAAA,QAAAE,gBAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,WAAA,WAAAA,WAAA,GAAAG,gBAAA,GAAAD,iBAAA,KAAAF,WAAA;AAAA,SAAAH,wBAAAO,GAAA,EAAAJ,WAAA,SAAAA,WAAA,IAAAI,GAAA,IAAAA,GAAA,CAAAC,UAAA,WAAAD,GAAA,QAAAA,GAAA,oBAAAA,GAAA,wBAAAA,GAAA,4BAAAE,OAAA,EAAAF,GAAA,UAAAG,KAAA,GAAAR,wBAAA,CAAAC,WAAA,OAAAO,KAAA,IAAAA,KAAA,CAAAC,GAAA,CAAAJ,GAAA,YAAAG,KAAA,CAAAE,GAAA,CAAAL,GAAA,SAAAM,MAAA,WAAAC,qBAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,GAAA,IAAAX,GAAA,QAAAW,GAAA,kBAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAd,GAAA,EAAAW,GAAA,SAAAI,IAAA,GAAAR,qBAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAV,GAAA,EAAAW,GAAA,cAAAI,IAAA,KAAAA,IAAA,CAAAV,GAAA,IAAAU,IAAA,CAAAC,GAAA,KAAAR,MAAA,CAAAC,cAAA,CAAAH,MAAA,EAAAK,GAAA,EAAAI,IAAA,YAAAT,MAAA,CAAAK,GAAA,IAAAX,GAAA,CAAAW,GAAA,SAAAL,MAAA,CAAAJ,OAAA,GAAAF,GAAA,MAAAG,KAAA,IAAAA,KAAA,CAAAa,GAAA,CAAAhB,GAAA,EAAAM,MAAA,YAAAA,MAAA;AAhBjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASW,gBAAgBA,CAC5BC,OAAe,EACfC,GAAY,EACZC,KAAc,EACdC,MAAe,EACfC,YAAqB,EACrBC,gBAAgB,GAAG,KAAK,EAClB;EACN,IAAI,OAAOJ,GAAG,KAAK,QAAQ,IAAI,CAACA,GAAG,EAAE;IACjC,OAAO,EAAE;EACb;EACA,IAAIA,GAAG,CAACK,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE;IAC7B,IAAID,gBAAgB,EAAE;MAClB,OAAOJ,GAAG;IACd,CAAC,MAAM;MACH,OAAO,EAAE;IACb;EACJ;EACA,IAAIM,gBAAgB,GAAGN,GAAG,CAACO,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;EACrC,IAAIC,MAAM,GAAG,6BAA6B;EAC1C,MAAMC,MAA8B,GAAG,CAAC,CAAC;EAEzC,IAAIR,KAAK,EAAE;IACPQ,MAAM,CAAC,OAAO,CAAC,GAAGC,IAAI,CAACC,KAAK,CAACV,KAAK,CAAC,CAACW,QAAQ,EAAE;EAClD;EACA,IAAIV,MAAM,EAAE;IACRO,MAAM,CAAC,QAAQ,CAAC,GAAGC,IAAI,CAACC,KAAK,CAACT,MAAM,CAAC,CAACU,QAAQ,EAAE;EACpD;EACA,IAAIT,YAAY,EAAE;IACdM,MAAM,CAAC,QAAQ,CAAC,GAAGN,YAAY;EACnC;EACA,IAAId,MAAM,CAACwB,IAAI,CAACJ,MAAM,CAAC,CAACK,MAAM,GAAG,CAAC,EAAE;IAChC;IACA;IACAN,MAAM,GAAG,8BAA8B;EAC3C;EAEA,MAAMO,cAAc,GAAGT,gBAAgB,CAACD,OAAO,CAAC,GAAG,CAAC;EACpD,IAAIW,QAAQ,GAAG,EAAE;EACjB,IAAID,cAAc,IAAI,CAAC,EAAE;IACrBC,QAAQ,GAAGV,gBAAgB,CAACC,KAAK,CAACQ,cAAc,CAAC;IACjDT,gBAAgB,GAAGA,gBAAgB,CAACC,KAAK,CAAC,CAAC,EAAEQ,cAAc,CAAC;EAChE;EAEA,MAAME,SAAS,GAAG5B,MAAM,CAACwB,IAAI,CAACJ,MAAM,CAAC,CAACK,MAAM,KAAK,CAAC,GAAG,EAAE,GAAG,GAAG,GAAGzC,KAAK,CAAC6C,YAAY,CAACT,MAAM,CAAC;EAC1F,OAAOV,OAAO,GAAGS,MAAM,GAAGF,gBAAgB,GAAGW,SAAS,GAAGD,QAAQ;AACrE"}